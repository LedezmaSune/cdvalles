<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Evaluaci√≥n Benchmark - Elektra</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* (ESTILO OMITIDO AQU√ç PARA BREVEDAD: lo copio si lo necesitas) */
  </style>
</head>
<body>

<div class="container">
  <h2>Evaluaci√≥n Benchmark - Elektra</h2>
  <form id="formulario">
    <div class="form-section">
      <h3>üìã Informaci√≥n General</h3>
      <div class="form-group">
        <label>Nombre del evaluador</label>
        <input type="text" name="evaluador" required />
      </div>
      <div class="form-group">
        <label>Nombre del vendedor</label>
        <input type="text" name="vendedor" required />
      </div>
      <div class="form-group">
        <label>Fecha de evaluaci√≥n</label>
        <input type="date" name="fecha" required />
      </div>
    </div>

    <!-- SECCIONES -->
    <!-- FUNCION PARA IMPRIMIR PREGUNTAS -->
    <script>
      const secciones = {
        "üöÄ ABORDA": [
          "Parafraseo y cuadro verbal",
          "Espejeo y prox√©mica",
          "Centramiento y alineaci√≥n emocional"
        ],
        "üîç DESCUBRE": [
          "Preguntas poderosas",
          "Valida la informaci√≥n"
        ],
        "üõ† SOLUCIONA": [
          "Prepara el producto",
          "Presenta el producto",
          "Invita a probar el producto",
          "Realiza pre-cierre"
        ],
        "üéØ CIERRA": [
          "Escucha objeciones",
          "Reformula objeci√≥n",
          "T√©cnica VEB / M√°ximos y m√≠nimos",
          "Verifica otras inquietudes",
          "Realiza cierre claro"
        ],
        "üîí ASEGURA": [
          "Anclaje emocional",
          "Facilita el pago"
        ]
      };
    </script>

    <div id="preguntas"></div>

    <button type="submit">
      <span class="button-text">Enviar y Generar PDF</span>
      <span class="button-loading" style="display:none;">‚è≥ Procesando...</span>
    </button>
  </form>
</div>

<div class="loading"><div class="spinner"></div></div>

<script>
  const form = document.getElementById("formulario");
  const preguntasDiv = document.getElementById("preguntas");

  // Render din√°mico de preguntas
  let preguntaIndex = 1;
  for (let [seccion, preguntas] of Object.entries(secciones)) {
    const section = document.createElement("div");
    section.className = "form-section";
    section.innerHTML = `<h3>${seccion}</h3>`;

    preguntas.forEach(p => {
      const key = seccion.match(/\w+/g)[0].toLowerCase() + preguntaIndex;
      const grupo = document.createElement("div");
      grupo.className = "form-group";
      grupo.innerHTML = `
        <label>${preguntaIndex}. ${p}</label>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="${key}" value="‚úî" required>
            ‚úî
          </label>
          <label class="radio-option">
            <input type="radio" name="${key}" value="X">
            ‚úò
          </label>
        </div>
      `;
      section.appendChild(grupo);
      preguntaIndex++;
    });

    preguntasDiv.appendChild(section);
  }

  const submitButton = form.querySelector("button[type='submit']");
  const loading = document.querySelector(".loading");

  form.addEventListener("submit", async e => {
    e.preventDefault();

    if (!form.checkValidity()) {
      alert("‚ö†Ô∏è Completa todos los campos antes de enviar.");
      return;
    }

    submitButton.disabled = true;
    loading.classList.add("active");
    submitButton.querySelector(".button-text").style.display = "none";
    submitButton.querySelector(".button-loading").style.display = "inline";

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    try {
      // Enviar a Google Sheets
      const res = await fetch("URL_DE_TU_WEBAPP", {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      });
      if (!res.ok) throw new Error("No se pudo enviar a Sheets");

      // PDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 20;
      doc.setFontSize(16);
      doc.setTextColor(42, 92, 170);
      doc.text("Evaluaci√≥n Benchmark - Elektra", 15, y);
      y += 10;

      doc.setFontSize(12);
      doc.setTextColor(0);
      doc.text("Evaluador: " + data.evaluador, 15, y); y += 6;
      doc.text("Vendedor: " + data.vendedor, 15, y); y += 6;
      doc.text("Fecha: " + data.fecha, 15, y); y += 10;

      for (let [key, val] of Object.entries(data)) {
        if (!["evaluador", "vendedor", "fecha"].includes(key)) {
          doc.text(`${key.toUpperCase()}: ${val}`, 15, y);
          y += 6;
          if (y > 270) { doc.addPage(); y = 20; }
        }
      }

      const fecha = data.fecha;
      const nombre = data.vendedor.replace(/\s+/g, "");
      doc.save(`Evaluacion-Benchmark-${nombre}-${fecha}.pdf`);
      alert("‚úÖ Enviado correctamente");
      form.reset();
    } catch (err) {
      console.error(err);
      alert("‚ùå Ocurri√≥ un error");
    } finally {
      submitButton.disabled = false;
      loading.classList.remove("active");
      submitButton.querySelector(".button-text").style.display = "inline";
      submitButton.querySelector(".button-loading").style.display = "none";
    }
  });
</script>

</body>
</html>
